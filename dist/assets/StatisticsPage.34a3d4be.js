import{T as f,g as D,d as B,F as O,h as x,e as W}from"./index.e33f3007.js";import{i as C}from"./echarts.61050811.js";import{bD as l,bz as p,bs as _,br as m,bE as e,bR as d,bL as A,by as b}from"./vendor.72204b0d.js";import"./vant.c7ef435c.js";import"./mock.f4bf4dcc.js";const L="_wrapper_kkstk_1",M={wrapper:L},I="_wrapper_wxcjg_1",Y={wrapper:I},F={tooltip:{show:!0,trigger:"axis",formatter:([t])=>{const[i,a]=t.data;return`${new f(new Date(i)).format("YYYY\u5E74MM\u6708DD\u65E5")} \uFFE5${D(a)}`}},grid:[{left:16,top:20,right:16,bottom:20}],xAxis:{type:"time",boundaryGap:["3%","0%"],axisLabel:{formatter:t=>new f(new Date(t)).format("MM-DD")},axisTick:{alignWithLabel:!0}},yAxis:{show:!0,type:"value",splitLine:{show:!0,lineStyle:{type:"dashed"}},axisLabel:{show:!1}}},V=l({props:{data:{type:Array,required:!0}},setup:(t,i)=>{const a=p();let r;return _(()=>{a.value!==void 0&&(r=C(a.value),r.setOption({...F,series:[{data:t.data,type:"line"}]}))}),m(()=>t.data,()=>{r==null||r.setOption({series:[{data:t.data}]})}),()=>e("div",{ref:a,class:Y.wrapper},null)}}),q="_wrapper_1cm6i_1",E={wrapper:q},N={tooltip:{trigger:"item",formatter:t=>{const{name:i,value:a,percent:r}=t;return`${i}: \uFFE5${D(a)} \u5360\u6BD4 ${r}%`}},grid:[{left:0,top:0,right:0,bottom:0}],series:[{type:"pie",radius:"70%",emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]},P=l({props:{data:{type:Array}},setup:(t,i)=>{const a=p();let r;return _(()=>{a.value!==void 0&&(r=C(a.value),r.setOption(N))}),m(()=>t.data,()=>{r==null||r.setOption({series:[{data:t.data}]})}),()=>e("div",{ref:a,class:E.wrapper},null)}}),j="_titleWrapper_1cs12_1",z="_title_1cs12_1",G="_barChartWrapper_1cs12_16",R="_barChart_1cs12_16",U="_topItem_1cs12_22",X="_sign_1cs12_28",H="_bar_wrapper_1cs12_39",J="_bar_text_1cs12_44",K="_bar_1cs12_16",Q="_bar_inner_1cs12_58",Z="_expensesBar_1cs12_66",tt="_incomeBar_1cs12_69",et="_tips_1cs12_72",s={titleWrapper:j,title:z,barChartWrapper:G,barChart:R,topItem:U,sign:X,bar_wrapper:H,bar_text:J,bar:K,bar_inner:Q,expensesBar:Z,incomeBar:tt,tips:et},at=l({props:{data:{type:Array},kind:{type:String}},setup:(t,i)=>()=>e(A,null,[e("div",{class:s.titleWrapper},[e("span",{class:s.title},[t.kind==="expenses"?"\u652F\u51FA\u5BF9\u6BD4":"\u6536\u5165\u5BF9\u6BD4"])]),e("div",{class:s.barChartWrapper},[e("div",{class:s.barChart},[t.data&&t.data.length>0?t.data.map(({tag:a,amount:r,percent:c})=>e("div",{class:s.topItem},[e("div",{class:s.sign},[a.sign]),e("div",{class:s.bar_wrapper},[e("div",{class:s.bar_text},[e("span",null,[a.name,d(" - "),c,d("%")]),e("span",null,[d("\uFFE5"),e(B,{value:r},null)])]),e("div",{class:s.bar},[e("div",{class:[s.bar_inner,t.kind==="expenses"?s.expensesBar:s.incomeBar],style:{width:`${c}%`}},null)])])])):e("div",{class:s.tips},[d("\u6CA1\u6709\u6570\u636E")])])])])}),rt=24*3600*1e3,st=l({props:{startDate:{type:String,required:!1},endDate:{type:String,required:!1}},setup:(t,i)=>{const a=p("expenses"),r=p([]),c=b(()=>{if(!t.startDate||!t.endDate)return[];const o=(new Date(t.endDate).getTime()-new Date(t.startDate).getTime())/rt+1;return Array.from({length:o}).map((g,S)=>{const w=new f(t.startDate+"T00:00:00.000+0800").add(S,"day").getTimestamp(),y=r.value[0],$=y&&new Date(y.happen_at+"T00:00:00.000+0800").getTime()===w?r.value.shift().amount:0;return[new Date(w).toISOString(),$]})}),h=async()=>{const n=await x.get("/items/summary",{happen_after:t.startDate,happen_before:t.endDate,kind:a.value,group_by:"happen_at"},{_mock:"itemSummary",_autoLoading:!0});r.value=n.data.groups};_(h),m(()=>a.value,h);const u=p([]),T=b(()=>u.value.map(n=>({name:n.tag.name,value:n.amount}))),k=b(()=>{const n=u.value.reduce((o,g)=>o+g.amount,0);return u.value.map(o=>({...o,percent:Math.round(o.amount/n*100)}))}),v=async()=>{const n=await x.get("/items/summary",{happen_after:t.startDate,happen_before:t.endDate,kind:a.value,group_by:"tag_id"},{_mock:"itemSummary"});u.value=n.data.groups};return _(v),m(()=>a.value,v),()=>e("div",{class:M.wrapper},[e(O,{label:"\u7C7B\u578B",type:"select",options:[{value:"expenses",text:"\u652F\u51FA"},{value:"income",text:"\u6536\u5165"}],modelValue:a.value,"onUpdate:modelValue":n=>a.value=n},null),e(V,{data:c.value},null),e(P,{data:T.value},null),e(at,{data:k.value},null)])}}),ct=l({setup:(t,i)=>()=>e(W,{rerenderOnSwitchTab:!0,component:st,hideThisYear:!0},null)});export{ct as StatisticsPage,ct as default};
